#import <Foundation/Foundation.h>
static NSString * const JsBridge_resource_event = @"var My_JsBridge=function(){var msgHandlerName='%@';var bridgeSyncIdentifier='%@';var bridgeAsyncIdentifier='%@';var callSuccessKey='%@';var callFailKey='%@';var callCompleteKey='%@';var callJsFuncArgKey='%@';var jsType=function(){var type={};var typeArr=['String','Object','Number','Array','Undefined','Function','AsyncFunction','Null','Symbol','Boolean','Arguments','Error','Window'];for(var i=0;i<typeArr.length;i++){(function(name){type['is'+name]=function(obj){return Object.prototype.toString.call(obj)=='[object '+name+']'}})(typeArr[i])}return type}();var callMap_keyId=0;var callMap_data={};var callMap_add=function(randomKey,funcNameKey,func){var funcMap=callMap_data[randomKey];if(!jsType.isObject(funcMap)){var map={};map[funcNameKey]=func;callMap_data[randomKey]=map}else{funcMap[funcNameKey]=func;callMap_data[randomKey]=funcMap}return randomKey+funcNameKey};var callMap_remove=function(randomKey){if(!callMap_data.hasOwnProperty(randomKey))return;delete callMap_data[randomKey]};var makeParams=function(apiPrefix,moduleName,methodName,params,index){if(!jsType.isObject(params)&&!(jsType.isFunction(params)||jsType.isAsyncFunction(params))){return params}var randomKey='-'+apiPrefix+'-'+(jsType.isUndefined(moduleName)?'Undefined':moduleName)+'-'+methodName+'-arg'+index+'-'+(new Date).getTime().toString()+'-'+(callMap_keyId++).toString()+'-';var newParams={};var funcId='';if(jsType.isFunction(params)||jsType.isAsyncFunction(params)){funcId=callMap_add(randomKey,callJsFuncArgKey,params);newParams[callJsFuncArgKey]=funcId;return newParams}newParams=params;var success=params.success;if(success&&(jsType.isFunction(success)||jsType.isAsyncFunction(success))){funcId=callMap_add(randomKey,callSuccessKey,success);newParams[callSuccessKey]=funcId}var fail=params.fail;if(fail&&(jsType.isFunction(fail)||jsType.isAsyncFunction(fail))){funcId=callMap_add(randomKey,callFailKey,fail);newParams[callFailKey]=funcId}var complete=params.complete;if(complete&&(jsType.isFunction(complete)||jsType.isAsyncFunction(complete))){funcId=callMap_add(randomKey,callCompleteKey,complete);newParams[callCompleteKey]=funcId}return newParams};var sendParams=function(apiPrefix,moduleName,methodName,bridgeIdentifier,params){var newParams=params;var resArgs=[];if(jsType.isArguments(newParams)){var argCount=newParams.length;for(var argIdx=0;argIdx<argCount;argIdx++){resArgs.push(makeParams(apiPrefix,moduleName,methodName,newParams[argIdx],argIdx))}}return{apiPrefix:apiPrefix,moduleName:moduleName,methodName:methodName,bridgeIdentifier:bridgeIdentifier,args:resArgs}};var sendNativeAsync=function(params){var handler=window.webkit.messageHandlers[msgHandlerName];handler.postMessage(JSON.parse(JSON.stringify(params)))};var sendNativeSync=function(params){var res=prompt(JSON.stringify(params));if(jsType.isNull(res)){return undefined}if(jsType.isString(res)&&res.length==0){return null}if(!res)return null;try{res=JSON.parse(res);return res.data}catch(error){if((jsType.isFunction(window.onerror)||jsType.isAsyncFunction(window.onerror))&&jsType.isError(error)){window.onerror.apply(window,[error])}}return null};var receviceNativeCall=function(params){var funcRes=null;if(!jsType.isString(params)||!params){return funcRes}var newParams=JSON.parse(decodeURIComponent(params));if(!jsType.isObject(newParams)){return funcRes}var funcId=newParams.funcId;var resDatas=jsType.isArray(newParams.data)?newParams.data:[];var alive=newParams.alive;var randomKey='',funcNameKey='';var matchKey=function(key){var matchNumber=funcId.length-key.length;if(matchNumber>=0&&funcId.lastIndexOf(key)==matchNumber){}else{return false}randomKey=funcId.replace(new RegExp(key,'g'),'');funcNameKey=key;return true};var matchRes=matchKey(callSuccessKey)||matchKey(callFailKey)||matchKey(callCompleteKey)||matchKey(callJsFuncArgKey);if(!matchRes)return funcRes;var funcMap=callMap_data[randomKey];if(!jsType.isObject(funcMap))return funcRes;var func=funcMap[funcNameKey];if(!(jsType.isFunction(func)||jsType.isAsyncFunction(func)))return funcRes;try{funcRes=func(...resDatas)}catch(error){if((jsType.isFunction(window.onerror)||jsType.isAsyncFunction(window.onerror))&&jsType.isError(error)){window.onerror.apply(window,[error])}funcRes=null}if(alive)return funcRes;if(funcNameKey==callCompleteKey||funcNameKey==callJsFuncArgKey){callMap_remove(randomKey)}return funcRes};var makeApi=function(apiPrefix,moduleName,apiMap){if(!apiPrefix||!jsType.isString(apiPrefix)||!jsType.isObject(apiMap)){return{}}var res={};var mapKeys=Object.keys(apiMap);for(var i=0;i<mapKeys.length;i++){(function(methodName){var config=apiMap[methodName];var isSync=config.hasOwnProperty('sync')?config.sync:false;res[methodName]=isSync?function(){return sendNativeSync(sendParams(apiPrefix,moduleName,methodName,bridgeSyncIdentifier,arguments))}:function(){sendNativeAsync(sendParams(apiPrefix,moduleName,methodName,bridgeAsyncIdentifier,arguments))}})(mapKeys[i])}return res};var makeModuleApi=function(apiPrefix,desApi,moduleApiMap){if(!apiPrefix||!jsType.isString(apiPrefix)||!desApi||!jsType.isObject(desApi)||!moduleApiMap||!jsType.isObject(moduleApiMap)){return desApi}var resModuleMap={};var mapKeys=Object.keys(moduleApiMap);for(var i=0;i<mapKeys.length;i++){(function(moduleName){resModuleMap[moduleName]=makeApi(apiPrefix,moduleName,moduleApiMap[moduleName])})(mapKeys[i])}var modulesKey='registerModules';var requireModuleKey='requireModule';desApi[modulesKey]=function(){return resModuleMap};desApi[requireModuleKey]=function(moduleName){if(!moduleName||!jsType.isString(moduleName)){return undefined}return resModuleMap[moduleName]};mapKeys=Object.keys(resModuleMap);for(var j=0;j<mapKeys.length;j++){(function(moduleName){desApi[moduleName]=function(){var moduleFunc=desApi[requireModuleKey];if(!moduleFunc){return moduleFunc}if(!(jsType.isFunction(moduleFunc)||jsType.isAsyncFunction(moduleFunc))){return undefined}return moduleFunc(moduleName)}})(mapKeys[j])}return desApi};return[receviceNativeCall,makeApi,makeModuleApi]}();var %@=My_JsBridge[0];var %@=My_JsBridge[1];var %@=My_JsBridge[2];";
static NSString * const JsBridge_resource_console = @"['log','debug','info','warn','error'].forEach(function(consoleKey){console[consoleKey]=function(oriFn){return function(){if(oriFn){oriFn.apply(console,arguments)}var jsType=function(){var type={};var typeArr=['String','Object','Number','Array','Undefined','Function','AsyncFunction','Null','Symbol','Boolean','Arguments','Error','Window'];for(var i=0;i<typeArr.length;i++){(function(name){type['is'+name]=function(obj){return Object.prototype.toString.call(obj)=='[object '+name+']'}})(typeArr[i])}return type}();try{var params=arguments;if(!jsType.isArguments(params)){return}var parseArg=function(arg){if(jsType.isString(arg)||jsType.isNumber(arg)||jsType.isUndefined(arg)||jsType.isNull(arg)||jsType.isBoolean(arg)){return arg}if(jsType.isError(arg)){var res={};['message','sourceURL','line','column','stack'].forEach(function(errKey){res[errKey]=arg[errKey]});return res}if(jsType.isArray(arg)){var newArg=[];try{newArg=JSON.parse(JSON.stringify(arg))}catch(error){}var res=[];for(var i=0;i<newArg.length;i++){res.push(parseArg(newArg[i]))}return res}if(jsType.isArguments(arg)){var res=[];for(var i=0;i<arg.length;i++){res.push(parseArg(arg[i]))}return res}if(jsType.isObject(arg)){var newArg={};try{newArg=JSON.parse(JSON.stringify(arg))}catch(error){}var res={};Object.keys(newArg).forEach(function(argKey){res[argKey]=parseArg(newArg[argKey])});return res}if(jsType.isSymbol(arg)||jsType.isWindow(arg)||jsType.isFunction(arg)||jsType.isAsyncFunction(arg)){return undefined}return undefined};var parseRes=[];for(var i=0;i<params.length;i++){parseRes.push({data:parseArg(params[i]),type:Object.prototype.toString.call(params[i])})}%@.sendNative(consoleKey,JSON.parse(JSON.stringify(parseRes)))}catch(error){}}}(console[consoleKey])});";
static NSString * const JsBridge_resource_network = @"(function(){if(typeof XMLHttpRequest!=='function'||typeof Proxy!=='function'||typeof Reflect!=='object'){return}window.XMLHttpRequest=new Proxy(XMLHttpRequest,{construct(ctor){var XMLReq=new ctor;return new Proxy(XMLReq,new function(XMLReq){var that=this;this.XMLReq=XMLReq;this.XMLReq.onreadystatechange=function(){that.onReadyStateChange()};this.XMLReq.onabort=function(){that.onAbort()};this.XMLReq.ontimeout=function(){that.onTimeout()};this.item={};this.item.requestHeader={};this.get=function(target,key){switch(key){case'open':return that.getOpen(target);case'send':return that.getSend(target);case'setRequestHeader':return that.getSetRequestHeader(target);default:var value=Reflect.get(target,key);if(typeof value==='function'){return value.bind(target)}else{return value}}};this.set=function(target,key,value){switch(key){case'onreadystatechange':return that.setOnReadyStateChange(target,key,value);case'onabort':return that.setOnAbort(target,key,value);case'ontimeout':return that.setOnTimeout(target,key,value);default:}return Reflect.set(target,key,value)};this.getOpen=function(target){var targetFunction=Reflect.get(target,'open');return function(){var args=arguments;var method=args[0];var url=args[1];that.item.method=method?method.toUpperCase():'GET';that.item.url=url||'';return targetFunction.apply(target,args)}};this.getSend=function(target){var targetFunction=Reflect.get(target,'send');return function(){var args=arguments;var data=args[0];that.item.postData=data;return targetFunction.apply(target,args)}};this.getSetRequestHeader=function(target){var targetFunction=Reflect.get(target,'setRequestHeader');return function(){var args=arguments;that.item.requestHeader[args[0]]=args[1];return targetFunction.apply(target,args)}};this.setOnReadyStateChange=function(target,key,value){return Reflect.set(target,key,function(){var args=arguments;that.onReadyStateChange();value.apply(target,args)})};this.setOnAbort=function(target,key,value){return Reflect.set(target,key,function(){var args=arguments;that.onAbort();value.apply(target,args)})};this.setOnTimeout=function(target,key,value){return Reflect.set(target,key,function(){var args=arguments;that.onTimeout();value.apply(target,args)})};this.onReadyStateChange=function(){that.item.readyState=that.XMLReq.readyState;that.item.responseType=that.XMLReq.responseType;switch(that.XMLReq.readyState){case 0:case 1:that.item.status=0;that.item.statusText='Pending';if(!that.item.startTime){that.item.startTime=Date.now()}break;case 2:that.item.status=that.XMLReq.status;that.item.statusText='Loading';that.item.responseHeader={};var responseHeader=that.XMLReq.getAllResponseHeaders()||'';if(1){that.item.responseHeader=responseHeader}else{}break;case 3:that.item.status=that.XMLReq.status;that.item.statusText='Loading';if(!!that.XMLReq.response&&that.XMLReq.response.length){that.item.responseSize=that.XMLReq.response.length}break;case 4:that.item.status=that.XMLReq.status||that.item.status||0;that.item.statusText=String(that.item.status);that.item.endTime=Date.now();that.item.costTime=that.item.endTime-(that.item.startTime||that.item.endTime);that.item.response=that.XMLReq.response;if(!!that.XMLReq.response&&that.XMLReq.response.length){that.item.responseSize=that.XMLReq.response.length}that.triggerUpdate();break;default:that.item.status=that.XMLReq.status;that.item.statusText='Unknown';that.triggerUpdate();break}};this.onAbort=function(){that.item.cancelState=1;that.item.statusText='Abort';that.triggerUpdate()};this.onTimeout=function(){that.item.cancelState=3;that.item.statusText='Timeout';that.triggerUpdate()};this.triggerUpdate=function(){var data=that.item;try{%@.sendNative(JSON.parse(JSON.stringify(data)))}catch(error){}}}(XMLReq))}})})();";
static NSString * const JsBridge_resource_error = @"window.onerror=function(oriFunc){return function(){try{if(oriFunc){oriFunc.apply(window,arguments)}var params=arguments;if(Object.prototype.toString.call(params)!='[object Arguments]'){return}var argCount=params.length;if(argCount==0){return}var resErr={};var keys=['message','sourceURL','line','column','stack'];if(Object.prototype.toString.call(params[0])=='[object Error]'){keys.forEach(function(el){resErr[el]=params[0][el]})}else{if(argCount>4&&Object.prototype.toString.call(params[4])=='[object Error]'){keys.forEach(function(el){resErr[el]=params[4][el]})}else{var minCount=Math.min(keys.length,argCount);for(let i=0;i<minCount;i++){resErr[keys[i]]=params[i]}}}%@.sendNative(JSON.parse(JSON.stringify(resErr)))}catch(error){}}}(window.onerror);window.addEventListener('error',function(arg){var type=Object.prototype.toString.call(arg);if(type==='[object Event]'&&arg.target&&arg.target.tagName){var res={message:'the resource('+arg.target.tagName+': '+(arg.target.src||arg.target.href)+') load fail.',tagName:arg.target.tagName,src:arg.target.src,href:arg.target.href};%@.sendNative(JSON.parse(JSON.stringify(res)))}return true},true);";
static NSString * const JsBridge_resource_socket = @"window.JsBridge_OriginSocket=WebSocket;window.WebSocket=function(url,protocols){var ws=new JsBridge_OriginSocket(url,protocols);setTimeout(function(){ws.addEventListener('message',function(event){var data=event.data;var formatData=[];if(data.length<=1){formatData=data}else{data=JSON.parse(data.substring(1));if(Object.prototype.toString.call(data)=='[object Array]'&&data.length>0){data=JSON.parse(data[0]);formatData.push(data);%@.socketDidReceiveMessage(data)}else{formatData=data}}})},1e3);return ws};";
